"use strict";angular.module("jsonFormatter",["RecursionHelper"]).provider("JSONFormatterConfig",function(){var a=!1,b=100,c=5;return{get hoverPreviewEnabled(){return a},set hoverPreviewEnabled(b){a=!!b},get hoverPreviewArrayCount(){return b},set hoverPreviewArrayCount(a){b=parseInt(a,10)},get hoverPreviewFieldCount(){return c},set hoverPreviewFieldCount(a){c=parseInt(a,10)},$get:function(){return{hoverPreviewEnabled:a,hoverPreviewArrayCount:b,hoverPreviewFieldCount:c}}}}).directive("jsonFormatter",["RecursionHelper","JSONFormatterConfig",function(a,b){function c(a){return a.replace('"','"')}function d(a){if(void 0===a)return"";if(null===a)return"Object";if("object"==typeof a&&!a.constructor)return"Object";var b=/function (.{1,})\(/,c=b.exec(a.constructor.toString());return c&&c.length>1?c[1]:""}function e(a){return null===a?"null":typeof a}function f(a,b){var d=e(a);return"null"===d||"undefined"===d?d:("string"===d&&(b='"'+c(b)+'"'),"function"===d?a.toString().replace(/[\r\n]/g,"").replace(/\{.*\}/,"")+"{…}":b)}function g(a){var b="";return angular.isObject(a)?(b=d(a),angular.isArray(a)&&(b+="["+a.length+"]")):b=f(a,a),b}function h(a){a.isArray=function(){return angular.isArray(a.json)},a.isObject=function(){return angular.isObject(a.json)},a.getKeys=function(){return a.isObject()?Object.keys(a.json).map(function(a){return""===a?'""':a}):void 0},a.type=e(a.json),a.hasKey="undefined"!=typeof a.key,a.getConstructorName=function(){return d(a.json)},"string"===a.type&&("Invalid Date"!==new Date(a.json).toString()&&(a.isDate=!0),0===a.json.indexOf("http")&&(a.isUrl=!0)),a.isEmptyObject=function(){return a.getKeys()&&!a.getKeys().length&&a.isOpen&&!a.isArray()},a.isOpen=!!a.open,a.toggleOpen=function(){a.isOpen=!a.isOpen},a.childrenOpen=function(){return a.open>1?a.open-1:0},a.openLink=function(b){b&&(window.location.href=a.json)},a.parseValue=function(b){return f(a.json,b)},a.showThumbnail=function(){return!!b.hoverPreviewEnabled&&a.isObject()&&!a.isOpen},a.getThumbnail=function(){if(a.isArray())return a.json.length>b.hoverPreviewArrayCount?"Array["+a.json.length+"]":"["+a.json.map(g).join(", ")+"]";var c=a.getKeys(),d=c.slice(0,b.hoverPreviewFieldCount),e=d.map(function(b){return b+":"+g(a.json[b])}),f=c.length>=5?"…":"";return"{"+e.join(", ")+f+"}"}}return{templateUrl:"json-formatter.html",restrict:"E",replace:!0,scope:{json:"=",key:"=",open:"="},compile:function(b){return a.compile(b,h)}}}]),"object"==typeof module&&(module.exports="jsonFormatter"),angular.module("RecursionHelper",[]).factory("RecursionHelper",["$compile",function(a){return{compile:function(b,c){angular.isFunction(c)&&(c={post:c});var d,e=b.contents().remove();return{pre:c&&c.pre?c.pre:null,post:function(b,f){d||(d=a(e)),d(b,function(a){f.append(a)}),c&&c.post&&c.post.apply(null,arguments)}}}}}]),angular.module("jsonFormatter").run(["$templateCache",function(a){a.put("json-formatter.html",'<div ng-init="isOpen = open && open > 0" class="json-formatter-row"><a ng-click="toggleOpen()"><span class="toggler {{isOpen ? \'open\' : \'\'}}" ng-if="isObject()"></span> <span class="key" ng-if="hasKey"><span class="key-text">{{key}}</span><span class="colon">:</span></span> <span class="value"><span ng-if="isObject()"><span class="constructor-name">{{getConstructorName(json)}}</span> <span ng-if="isArray()"><span class="bracket">[</span><span class="number">{{json.length}}</span><span class="bracket">]</span></span></span> <span ng-if="!isObject()" ng-click="openLink(isUrl)" class="{{type}}" ng-class="{date: isDate, url: isUrl}">{{parseValue(json)}}</span></span> <span ng-if="showThumbnail()" class="thumbnail-text">{{getThumbnail()}}</span></a><div class="children" ng-if="getKeys().length && isOpen"><json-formatter ng-repeat="key in getKeys() track by $index" json="json[key]" key="key" open="childrenOpen()"></json-formatter></div><div class="children empty object" ng-if="isEmptyObject()"></div><div class="children empty array" ng-if="getKeys() && !getKeys().length && isOpen && isArray()"></div></div>')}]),angular.module("clusterpost-list",["ui.bootstrap","smart-table","jsonFormatter","jwt-user-login"]),angular.module("clusterpost-list").factory("clusterpostService",["$q","$http","$location",function(a,b,c){return{getExecutionServers:function(){return b({method:"GET",url:"/executionserver"})},getJobStatus:function(a){return b({method:"GET",url:"/executionserver/"+a})},submitJob:function(a,c){return b({method:"POST",url:"/executionserver/"+a,data:{force:c}})},killJob:function(a){return b({method:"DELETE",url:"/executionserver/"+a})},createJob:function(a){return b({method:"POST",url:"/dataprovider",data:a})},getAllJobs:function(a){return b({method:"GET",url:"/dataprovider",params:{executable:a}})},updateJob:function(a){return b({method:"PUT",url:"/dataprovider",data:a})},getJob:function(a){return b({method:"GET",url:"/dataprovider/"+a})},getAttachment:function(a,c,d){return b({method:"GET",url:"/dataprovider/"+a+"/"+encodeURIComponent(c),responseType:d})},addAttachment:function(a,c,d){return b({method:"PUT",url:"/dataprovider/"+a+"/"+c,data:d})},getJobUser:function(a,c,d){return b({method:"GET",url:"/dataprovider/user",params:{userEmail:a,jobstatus:c,executable:d}})},deleteJob:function(a){return b({method:"DELETE",url:"/dataprovider/"+a})}}}]),angular.module("clusterpost-list").directive("clusterpostJobs",["$routeParams","$location","clusterpostService","$filter","$q","clusterauth",function(a,b,c,d,e,f){function g(a,b){a.jobs={selectedJob:{}},a.jobs.onFilter=function(b){a.jobs.filteredJobs=b},a.updateStatus=function(a){c.getJobStatus(a._id).then(function(b){a.jobstatus=b.data}).catch(function(a){throw console.error(a),a})},a.killJob=function(a){c.killJob(a._id).then(function(b){a.jobstatus=b.data}).catch(function(a){throw console.error(a),a})},a.removeRow=function(b){var c=a.rowCollection.indexOf(b);c!==-1&&a.rowCollection.splice(c,1)},a.deleteJob=function(a){c.deleteJob(a._id).then(function(a){}).catch(function(a){throw console.error(a),a})},a.runJob=function(b,d){c.submitJob(b._id,d).then(function(b){a.getDB()}).catch(function(a){console.error(a)})},a.getDB=function(){c.getAllJobs().then(function(b){a.jobs.data=b.data,a.jobs.status=_.uniq(_.pluck(_.pluck(b.data,"jobstatus"),"status")),a.jobs.executables=_.uniq(_.pluck(b.data,"executable"))}).catch(function(a){console.error(a)})},a.showJobDetail=function(b){a.jobs.selectedJob.job=b,a.activeTab=1,c.getAttachment(b._id,"stdout.out","text").then(function(b){a.jobs.selectedJob.stdout=b.data}).catch(console.error),c.getAttachment(b._id,"stderr.err","text").then(function(b){a.jobs.selectedJob.stderr=b.data}).catch(console.error)},a.runAllJobs=function(){if(a.jobs.filteredJobs){var b=_.map(a.jobs.filteredJobs,function(a){return c.submitJob(a._id).then(function(a){console.log(a)}).catch(console.error)});Promise.all(b).catch(console.error)}},a.updateAllJobs=function(){if(a.jobs.filteredJobs){var b=_.map(a.jobs.filteredJobs,function(a){return c.getJobStatus(a._id).then(function(b){a.jobstatus=b.data}).catch(console.error)});Promise.all(b).catch(console.error)}},a.deleteAllJobs=function(){if(a.jobs.filteredJobs){var b=_.map(a.jobs.filteredJobs,a.deleteJob);Promise.all(b).catch(console.error)}},a.numJobsInPage=[{id:"0",value:"10"},{id:"1",value:"50"},{id:"2",value:"100"}],a.rowCollection=[],a.getDB(),a.forceRunJob=!1,a.activeTab=0}return{restrict:"E",link:g,templateUrl:"./src/clusterpost-list.directive.html"}}]),angular.module("clusterpost-list").directive("onFilter",function(){return{require:"^stTable",scope:{onFilter:"="},link:function(a,b,c,d){a.$watch(d.getFilteredCollection,function(b){a.onFilter&&a.onFilter(b)})}}}),angular.module("clusterpost-list").run(["$templateCache",function(a){a.put("./src/clusterpost-list.directive.html",'<uib-tabset active="activeTab">\n\t<uib-tab heading="Jobs" index="0">\n\t\t<table st-table="jobs.displayedJobs" st-safe-src="jobs.data" class="table table-striped" on-filter="jobs.onFilter">\n\t\t\t\t<thead>\n\t\t\t\t<tr>\n\t\t\t\t\t<th colspan="6"><input st-search="" class="form-control" placeholder="Global search ..." type="text"/></th>\n\t\t\t\t\t<th colspan="5">Number of jobs per page \n\t\t\t\t\t\t<select class="form-control" ng-model="itemsByPage" ng-options="option.value for option in numJobsInPage track by option.id"></select>\n\t\t\t\t\t</th>\n\t\t\t\t</tr>\n\t\t\t\t<tr>\n\t\t\t\t\t<th st-sort="_id"> Id </th>\n\t\t\t\t\t<th st-sort="userEmail">User email</th>\n\t\t\t\t\t<th st-sort="timestamp">Timestamp</th>\n\t\t\t\t\t<th st-sort="jobsstatus.status">Job status</th>\n\t\t\t\t\t<th st-sort="row.executable"> Executable </th>\n\t\t\t\t\t<th st-sort="jobstatus.jobid">Job Id</th>\n\t\t\t\t\t<th>Update</th>\n\t\t\t\t\t<th>Run</th>\n\t\t\t\t\t<th>Force run</th>\n\t\t\t\t\t<th>Kill</th>\n\t\t\t\t\t<th>Delete</th>\n\t\t\t\t</tr>\n\t\t\t\t<tr>\n\t\t\t\t\t<th>\n\t\t\t\t\t\t<input st-search="_id" placeholder="search for id" class="input-sm form-control" type="search"/>\n\t\t\t\t\t</th>\n\t\t\t\t\t<th>\n\t\t\t\t\t\t<input st-search="userEmail" placeholder="search for userEmail" class="input-sm form-control" type="search"/>\n\t\t\t\t\t</th>\n\t\t\t\t\t<th>\n\t\t\t\t\t\t<input st-search="timestamp" placeholder="search for timestamp" class="input-sm form-control" type="search"/>\n\t\t\t\t\t</th>\n\t\t\t\t\t<th> \n\t\t\t\t\t\t<select class="form-control" st-search="jobstatus.status">\n\t                    \t<option value="">All</option>\n\t                    \t<option ng-repeat="st in jobs.status">{{st}}</option>\n\t                \t</select>\n\t\t\t\t\t</th>\n\t\t\t\t\t<th>\n\t\t\t\t\t\t<select class="form-control" st-search="executable">\n\t                    \t<option value="">All</option>\n\t                    \t<option ng-repeat="ex in jobs.executables">{{ex}}</option>\n\t                \t</select>\n\t\t\t\t\t</th>\n\t\t\t\t\t<th>\n\t\t\t\t\t</th>\n\t\t\t\t\t<th>\n\t\t\t\t\t\t<button type="button" ng-click="updateAllJobs()" class="btn btn-sm btn-info">\n\t\t\t\t\t\t<i class="glyphicon glyphicon-refresh">\n\t\t\t\t\t\t\t</i>\n\t\t\t\t\t\t</button>\n\t\t\t\t\t</th>\n\t\t\t\t\t<th>\n\t\t\t\t\t\t<button type="button" ng-click="runAllJobs()" class="btn btn-sm btn-success">\n\t\t\t\t\t\t<i class="glyphicon glyphicon-play">\n\t\t\t\t\t\t\t</i>\n\t\t\t\t\t\t</button>\n\t\t\t\t\t</th>\n\t\t\t\t\t<th>\n\t\t\t\t\t</th>\n\t\t\t\t\t<th>\n\t\t\t\t\t</th>\n\t\t\t\t\t<th>\n\t\t\t\t\t\t<button type="button" ng-click="deleteAllJobs()" class="btn btn-sm btn-danger">\n\t\t\t\t\t\t<i class="glyphicon glyphicon-trash">\n\t\t\t\t\t\t\t</i>\n\t\t\t\t\t\t</button>\n\t\t\t\t\t</th>\n\n\t\t\t\t</tr>\n\t\t\t\t</thead>\n\t\t\t\t<tbody>\n\t\t\t\t<tr ng-repeat="row in jobs.displayedJobs">\n\t\t\t\t\t<td><button class="btn btn-default" ng-click="showJobDetail(row)">{{row._id}}</button></td>\n\t\t\t\t\t<td>{{row.userEmail}}</td>\n\t\t\t\t\t<td>{{row.timestamp}}</td>\n\t\t\t\t\t<td>{{row.jobstatus.status}}</td>\n\t\t\t\t\t<td>{{row.executable}}</td>\n\t\t\t\t\t<td>{{row.jobstatus.jobid}}</td>\n\t\t\t\t\t<td>\n\t\t\t\t\t\t<button type="button" ng-click="updateStatus(row)" class="btn btn-sm btn-info">\n\t\t\t\t\t\t\t<i class="glyphicon glyphicon-refresh">\n\t\t\t\t\t\t\t</i>\n\t\t\t\t\t\t</button>\n\t\t\t\t\t</td>\n\t\t\t\t\t<td>\n\t\t\t\t\t\t<button type="button" ng-click="runJob(row,forceRunJob)" class="btn btn-sm btn-success">\n\t\t\t\t\t\t<i class="glyphicon glyphicon-play">\n\t\t\t\t\t\t\t</i>\n\t\t\t\t\t\t</button>\n\t\t\t\t\t</td>\n\t\t\t\t\t<td>\n\t\t\t\t\t\t<input type="checkbox" ng-model="forceRunJob"/>\n\t\t\t\t\t</td>\n\t\t\t\t\t<td>\n\t\t\t\t\t\t<button type="button" ng-click="killJob(row)" class="btn btn-sm btn-warning">\n\t\t\t\t\t\t\t<i class="glyphicon glyphicon-remove-circle">\n\t\t\t\t\t\t\t</i>\n\t\t\t\t\t\t</button>\n\t\t\t\t\t</td>\n\t\t\t\t\t<td>\n\t\t\t\t\t\t<button type="button" ng-click="deleteJob(row)" class="btn btn-sm btn-danger">\n\t\t\t\t\t\t\t<i class="glyphicon glyphicon-trash">\n\t\t\t\t\t\t\t</i>\n\t\t\t\t\t\t</button>\n\t\t\t\t\t</td>\n\t\t\t\t</tr>\n\t\t\t\t</tbody>\n\t\t\t\t<tfoot>\n\t\t\t\t<tr>\n\t\t\t\t\t<td colspan="10" class="text-center">\n\t\t\t\t\t\t<div st-pagination="" st-items-by-page="itemsByPage.value" st-displayed-pages="7"></div>\n\t\t\t\t\t</td>\n\t\t\t\t</tr>\n\t\t\t</tfoot>\n\t\t</table>\n\t</uib-tab>\n\t<uib-tab heading="Job detail" index="1">\n\t\t<div class="col-md-12">\n\t\t\t<div class="col-md-6 alert alert-info" role="alert">\n\t\t\t\t{{jobs.selectedJob.stdout}}\n\t\t\t</div>\n\t\t\t<div class="col-md-6 alert alert-warning" role="alert">\n\t\t\t  \t{{jobs.selectedJob.stderr}}\n\t\t\t</div>\n\t\t</div>\n\t\t<div class="col-md-12">\n  \t\t\t<json-formatter json="jobs.selectedJob.job" open="4"></json-formatter>\n  \t\t</div>\n\t</uib-tab>\n</uib-tabset>\n ')}]);